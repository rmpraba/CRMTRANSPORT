<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../changepoint-service/changepoint-service.html">
<link rel="import" href="../../border-collapse: collapse;
    border: 1px solid #6699ff;
   padding: 5px;
   width: 65%;
   margin-left: 18em;bower_components/iron-ajax/iron-ajax.html">
<meta name="viewport" content="width=device-width, initial-scale=1">

<dom-module id="changepoint-list">
<style type="text/css">
  .flexchild-vertical 
  { 
    @apply(--layout-horizontal);
  }
   .card
      {
        width:57%;
        height:220px;
        margin-left: 26%;
        background-color: white; 
        box-shadow: 0 0 3px 3px rgb(184, 209, 249); -moz-box-shadow: 0 0 3px 3px rgb(184, 209, 249); -webkit-box-shadow: 0 0 3px 3px gb(184, 209, 249); -o-box-shadow: 0 0 3px 3px rgb(184, 209, 249); 
      }
      .detail
      {
        @apply(--layout-horizontal);
      }
</style>
<template>
  <legend align="center"></legend>
  <paper-input hidden class="field" value="{{schooltype}}"></paper-input>
    
  <div class="card">
    <!-- <ul> -->
      <li class="ro11">
        <fieldset>
        <ul>
          <div class="check-box" style="margin-right: -8em;">
            <paper-checkbox id="selectbox" on-change="changeHandler"></paper-checkbox>
          </div>
            <li class="row">
              <div class="detail">
                <div class="field" style="padding: 0 1% 0 1%;">
                    <paper-input readonly class="field" value="{{studentid}}"></paper-input>
                </div>
                <div class="field"  style="margin-left: 3em;">
                    <paper-input readonly class="field" value="{{studentname}}"></paper-input>
                </div>
              </div>
            </li>

            <li class="row">
              <div class="detail">
                <div class="field">
                  <paper-dropdown-menu id="set" label="Pick-up Route">
                    <paper-menu id="pickrt1" class="dropdown-content" required    on-iron-select="pickroute" 
                      attr-for-selected="value" selected="{{pkroutezz}}">
                      <template  is="dom-repeat" items="{{routearr}}" as="view">
                        <paper-item value="{{view.id}}">{{view.route_name}}</paper-item>
                      </template>
                    </paper-menu>
                  </paper-dropdown-menu>
                </div>
                <div class="field" style="margin-left: 3em;">
                  <paper-dropdown-menu id="set1" label="Pick-up Point">
                    <paper-menu id="pickpnt1" class="dropdown-content" required on-iron-select="pickpoints" 
                    attr-for-selected="value" selected="{{pkpointzz}}">  
                      <template  is="dom-repeat" items="{{pointarr}}" as="view">
                        <paper-item value="{{view.id}}">{{view.point_name}}</paper-item>
                      </template>
                    </paper-menu>
                  </paper-dropdown-menu>
                </div>
              </div>
            </li>

            <li class="row">
              <div class="detail">
                <div class="field">
                  <paper-dropdown-menu id="set2" label="Drop Route">
                    <paper-menu id="droprt2" class="dropdown-content" required on-iron-select="droproute" 
                    attr-for-selected="value" selected="{{dproutezz}}">
                      <template  is="dom-repeat" items="{{routearr}}" as="view">
                        <paper-item value="{{view.id}}">{{view.route_name}}</paper-item>
                      </template>
                    </paper-menu>
                  </paper-dropdown-menu>
                </div>
                <div class="field" style="margin-left: 3em;">
                  <paper-dropdown-menu id="set3" label="Drop Point">
                    <paper-menu id="droppnt2" class="dropdown-content" required on-iron-select="droppoints" 
                    attr-for-selected="value" selected="{{dppointzz}}">
                      <template  is="dom-repeat" items="{{droparr}}" as="view">
                        <paper-item value="{{view.id}}">{{view.point_name}}</paper-item>
                      </template>
                    </paper-menu>
                  </paper-dropdown-menu>
                </div>
              </div>
              </li>
                 <!-- <paper-input label="Pickip Route" value="{{pkroutezz}}"></paper-input>  -->
        </ul>
        </fieldset>
      </li>
    <!-- </ul> -->
  </div>

    <changepoint-services id="mapstud"></changepoint-services>
  <iron-ajax
    method="post"
    id="selectpointajax"
    url="{{selectpointurl}}"
    handle-as="json"
    content-type="application/json"
    params="{{routepickpointparam}}"
    on-response="pickpointsResponse"
    debounce-duration="300"
  >
  </iron-ajax>
    <iron-ajax
    method="post"
    id="routedroppointajax"
    url="{{routedroppointurl}}"
    handle-as="json"
    content-type="application/json"
    params="{{routedroppointparam}}"
    on-response="droppointsResponse"
    debounce-duration="300"
  >
  </iron-ajax>
    <iron-ajax
        method="post"
        id="routepointajax"
        url="{{routepointurl}}"
        params="{{routepointparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="routepointResponse"
        debounce-duration="300"
        >
  </iron-ajax>
  <!-- <iron-ajax
        method="post"
        id="prevpickajax"
        url="{{prevpickurl}}"
        params="{{prevpickparam}}"
        handle-as="json"
        content-type="application/json"
        on-response="prevpickResponse"
        debounce-duration="300"
        >
  </iron-ajax> -->
  </template>
  <script>
  (function() {
      var pickroute;
      var pickpoint;
      var droproute;
      var droppoint;
    var scholtype;
      var school=sessionStorage.getItem("sch");

      var pickrouteid;
      var droprouteid;
    Polymer({
      is: "changepoint-list",
      ready:function()
      {
        this.routepointurl =sessionStorage.getItem("addrinfo")+"/routepoint";
        var obj={"schol":"","academic_year":""}
         obj.schol=sessionStorage.getItem("sch");
         obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        this.routepointparam=obj;
        //alert(JSON.stringify(obj));
        this.$.routepointajax.generateRequest();

        this.$.selectbox.disabled=true;  

        /*this.prevpickurl=sessionStorage.getItem("addrinfo")+"/chprevpick";
         var obj1={"schol":"","studentid":"","academic_year":""}
         obj1.schol=sessionStorage.getItem("sch");
         obj1.academic_year=localStorage.getItem("curr_sess_academicyear");
         obj1.studentid=this.studentid;
         this.prevpickparam=obj1;
       // alert(JSON.stringify(obj1));
    
        this.$.prevpickajax.generateRequest();*/
      },
      /*prevpickResponse:function(e)
      {
        var res=e.detail.response.returnval;
        alert(333333);
        alert(JSON.stringify(res));

        alert(this.selectproute+""+this.selectpick+""+this.selectid+""+this.selectpoint);
       this.selectproute=res[0].pickuproutename;
       this.selectpick=res[0].pickpointname;
       this.selectid=res[0].droproutename;
       this.selectpoint=res[0].droppointname;
      },*/

      routepointResponse:function(e)
      {
        var route=e.detail.response.returnval;
       // alert(2222222);
        //alert(JSON.stringify(route));
        this.routearr=route;
      },
      pickroute:function(e){
        pickrouteid = e.target.selectedItem.value;
        pickroute=(e.target.selectedItem.textContent).trim();
        droproute=pickroute;
        //this.selectid=pickroute;
        this.selectpointurl = sessionStorage.getItem("addrinfo")+"/pickpoints";
      var obj={"routept":"","studid":"","schol":"","schooltype":"","academic_year":""};
        obj.schol=sessionStorage.getItem("sch");
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        obj.routept=pickrouteid;
        obj.studid=this.studentid;
        
        scholtype=this.schooltype;
        if(scholtype=='Primary')
        {
          obj.schooltype=1;
        }
        else 
        {
          obj.schooltype=2;
        }
        this.routepickpointparam=obj;
        alert(JSON.stringify(obj));
        this.$.selectpointajax.generateRequest();
      },
      droproute:function(e){
        droprouteid = (e.target.selectedItem.value);
        droproute=(e.target.selectedItem.textContent).trim();
        this.routedroppointurl = sessionStorage.getItem("addrinfo")+"/routedroppoint";
        var obj={"routedroppt":"","studid":"","schol":"","schooltype":"","academic_year":""};
        obj.academic_year=localStorage.getItem("curr_sess_academicyear");
        obj.schol=sessionStorage.getItem("sch");
        obj.routedroppt=droprouteid;
        obj.studid=this.studentid;

        scholtype=this.schooltype;
        if(scholtype=='Primary')
        {
          obj.schooltype=1;
        }
        else {
          obj.schooltype=2;
        }
        this.routedroppointparam=obj;
        this.$.routedroppointajax.generateRequest();
         this.$.selectbox.disabled=true;
      },
      pickpointsResponse:function(e)
      {
        var points=e.detail.response.returnval;
        alert("testtt");
        alert(JSON.stringify(points));
          //this.droparr=points;
        this.pointarr=points;
      },
      droppointsResponse:function(e){

        var points=e.detail.response.returnval;
        this.droparr=[];
        this.droparr=points;
      },
      pickpoints:function(e){
        this.pickpointid = e.target.selectedItem.value;
        pickpoint=(e.target.selectedItem.textContent).trim();
        //this.selectpoint=pickpoint;
        droppoint=pickpoint;
        this.$.selectbox.disabled=false;
      },
      droppoints:function(e){
        this.droppointid = (e.target.selectedItem.value);
        droppoint=(e.target.selectedItem.textContent).trim();
         this.$.selectbox.disabled=false;
      },
      changeHandler:function(e){
        var box = document.querySelector("#selectbox");
        if(e.target.checked==true)
        {
        document.querySelector('changepoint-card').FnGetItemsz(this.studentid,pickroute,droproute,pickpoint,droppoint);

       this.$.set.disabled=true;
       this.$.set1.disabled=true;
       this.$.set2.disabled=true;
       this.$.set3.disabled=true;

        }
        else
        {
          document.querySelector('changepoint-card').removestud(this.studentid);

            this.$.set.disabled=false;
           this.$.set1.disabled=false;
           this.$.set2.disabled=false;
           this.$.set3.disabled=false;
        }
    },

      /*fnpickroute:function(e)
      {
        //alert("pickroute");
        this.pkroutezz=e[0].pickuproutename;
        alert(this.pkroutezz);
      },

      fnpickpoint:function(e)
      {
        //alert("pickpoint");
        this.pkpointzz=e[0].pickpointname;
        alert(this.pkpointzz);
      },

      fndroproute:function(e)
      {
        //alert("droproute");
        this.dproutezz=e[0].droproutename;
        alert(this.dproutezz);
      },

    fndroppint:function(e)
    {
      //alert("droppoint");
     this.dppointzz=e[0].droppointname; 
     alert(this.dppointzz);
    }*/

   /* fnrefresh:function()
    {
      document.querySelector('#pickrt1').selected=-1;
      document.querySelector('#pickpnt1').selected=-1;
      document.querySelector('#droprt2').selected=-1;
      document.querySelector('#droppnt2').selected=-1;
    }*/
    
  
  });
  })();
  </script>

</dom-module>
